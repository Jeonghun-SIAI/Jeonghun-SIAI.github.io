<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="ko" class="no-js">

<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BBZ8BXY4N7"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-BBZ8BXY4N7');
</script>
  <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Optimal power flow 예제 소개 문헌 및 풀이 코드 | 에너지엔데이터연구소</title>
<meta name="description" content="필자의 ‘선형계획법 기반 분산에너지시스템 최적화’ 시리즈 글에서는, 유효전력의 수요-공급을 고려하는 설비도입계획을 다루었다. 그러나 기 구축된 대규모 발송전시스템의 실제 운영은, 각 발전기 및 bus의 전압/ 무효전력/ 위상도 고려하는 optimal power flow (OPF) 문제를 풀어 이루어진다.">


  <meta name="author" content="Jeonghun Song">
  
  <meta property="article:author" content="Jeonghun Song">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="ko_KR">
<meta property="og:site_name" content="에너지엔데이터연구소">
<meta property="og:title" content="Optimal power flow 예제 소개 문헌 및 풀이 코드">
<meta property="og:url" content="https://song4energyndata.github.io/opf.html">


  <meta property="og:description" content="필자의 ‘선형계획법 기반 분산에너지시스템 최적화’ 시리즈 글에서는, 유효전력의 수요-공급을 고려하는 설비도입계획을 다루었다. 그러나 기 구축된 대규모 발송전시스템의 실제 운영은, 각 발전기 및 bus의 전압/ 무효전력/ 위상도 고려하는 optimal power flow (OPF) 문제를 풀어 이루어진다.">



  <meta property="og:image" content="https://song4energyndata.github.io/assets/images/opf/network.png">





  <meta property="article:published_time" content="2023-11-11T00:00:00+09:00">





  

  


<link rel="canonical" href="https://song4energyndata.github.io/opf.html">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "송정훈",
      "url": "https://song4energyndata.github.io/"
    
  }
</script>






  <meta name="naver-site-verification" content="7dda6777a2acc897ba51668ac7c58c380307dd6c">


<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="에너지엔데이터연구소 Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



<link rel="alternate" type="application/rss+xml" href="https://song4energyndata.github.io/feed.xml">
  <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<head>
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
</head>


<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        TeX: {
          equationNumbers: {
            autoNumber: "AMS"
          }
        },
        tex2jax: {
        inlineMath: [ ['$', '$'] ],
        displayMath: [ ['$$', '$$'] ],
        processEscapes: true,
      }
    });
    MathJax.Hub.Register.MessageHook("Math Processing Error",function (message) {
          alert("Math Processing Error: "+message[1]);
        });
    MathJax.Hub.Register.MessageHook("TeX Jax - parse error",function (message) {
          alert("Math Processing Error: "+message[1]);
        });
    </script>
<script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


<!-- end custom head snippets -->
  <style> 
    ::-webkit-scrollbar{width: 12px;}
    ::-webkit-scrollbar-track {background-color:#ced8e7; border-radius: 8px;}
    ::-webkit-scrollbar-thumb {background-color:#eeebeb; border-radius: 8px;}
    ::-webkit-scrollbar-thumb:hover {background: #f7f6f3;}
    ::-webkit-scrollbar-button:start:decrement,::-webkit-scrollbar-button:end:increment 
    {width:12px;height:16px;background:transparent;} 
  </style>
</head>

<body
  class="layout--single">
  <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

  

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          에너지엔데이터연구소
          <span class="site-subtitle">에너지 데이터의 올바른 활용, 에너지 전환에 대한 데이터 기반의 합리적 솔루션</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/aboutme/">About Me</a>
            </li><li class="masthead__menu-item">
              <a href="/search/">Search</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/">Category</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/">Tag</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">카테고리 목록</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


  <div class="initial-content">
    





<div id="main" role="main">
  

  <div class="sidebar sticky">
    
  
  
  
  
    
    
      
    
    
  
  
   <!-- three lines added by Jeonghun  -->
    

<nav class="nav__list">
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">카테고리 목록</label>
  <ul class="nav__items" id="category_tag_menu">
      <!--전체 글 수-->
      
      <li>
        <!--span 태그로 카테고리들을 크게 분류 ex) C/C++/C#-->
        <span class="nav__sub-title">Categories</span>
            <!--ul 태그로 같은 카테고리들 모아둔 페이지들 나열-->
            <ul>
                
                    
                
                    
                
                    
                
                    
                        <li><a href="/optimalsystem" class="">&#x2022 경제성분석 및 최적구성 도출 [11]</a></li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
            <ul>
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <li><a href="/market" class="">&#x2022 전력시장 모델링 [15]</a></li>
                    
                
                    
                
            </ul>
            <ul>
                <!--Cpp 카테고리 글들을 모아둔 페이지인 /categories/cpp 주소의 글로 링크 연결-->
                <!--category[1].size 로 해당 카테고리를 가진 글의 개수 표시--> 
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <li><a href="/energymanagement" class="">&#x2022 제어 (최적화/ 강화학습) [5]</a></li>
                    
                
                    
                
                    
                
            </ul>
            <ul>
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <li><a href="/estimation" class="">&#x2022 예측 (회귀분석/ 머신러닝/ 딥러닝) [2]</a></li>
                    
                
                    
                
                    
                
                    
                
            </ul>
            <ul>
                
                    
                
                    
                
                    
                
                    
                
                    
                        <li><a href="/dataset" class="">&#x2022 데이터셋 (소개/ 전처리/ 활용안) [7]</a></li>
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
            <ul>
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <li><a href="/policy" class="">&#x2022 정책 (패널분석/ 시나리오분석) [1]</a></li>
                    
                
            </ul>
            <ul>
                
                    
                
                    
                        <li><a href="/mathstat" class="">&#x2022 수학/ 통계학 일반 [3]</a></li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
            <ul>
                
                    
                
                    
                
                    
                        <li><a href="/mypapers" class="">&#x2022 My papers [2]</a></li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
            <ul>
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
            <ul>
                
                    
                        <li><a href="/etc" class="">&#x2022 Etc. [2]</a></li>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </ul>
      </li>
  </ul>
</nav>
  
  

  </div>




  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Optimal power flow 예제 소개 문헌 및 풀이 코드">
    <meta itemprop="description" content="필자의 ‘선형계획법 기반 분산에너지시스템 최적화’ 시리즈 글에서는, 유효전력의 수요-공급을 고려하는 설비도입계획을 다루었다. 그러나 기 구축된 대규모 발송전시스템의 실제 운영은, 각 발전기 및 bus의 전압/ 무효전력/ 위상도 고려하는 optimal power flow (OPF) 문제를 풀어 이루어진다.">
    <meta itemprop="datePublished" content="2023-11-11T00:00:00+09:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="https://song4energyndata.github.io/opf.html" class="u-url" itemprop="url">Optimal power flow 예제 소개 문헌 및 풀이 코드
</a>
          </h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2023-11-11T00:00:00+09:00">2023-11-11</time>
      </span>
    

    

    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> Contents</h4></header> 
              <ul class="toc__menu"><li><a href="#opf-예시-및-문헌-소개">OPF 예시 및 문헌 소개</a></li><li><a href="#opf-풀이에-쓰이는-수식들">OPF 풀이에 쓰이는 수식들</a></li><li><a href="#예제-풀이용-python-코드">예제 풀이용 python 코드</a></li></ul>
 <!-- 우측 TOC -->
            </nav>
          </aside>
        
        <p><a href="https://song4energyndata.github.io/linprogone.html">필자의 ‘선형계획법 기반 분산에너지시스템 최적화’ 시리즈 글</a>에서는, 유효전력의 수요-공급을 고려하는 설비도입계획을 다루었다. 그러나 기 구축된 대규모 발송전시스템의 실제 운영은, 각 발전기 및 bus의 전압/ 무효전력/ 위상도 고려하는 optimal power flow (OPF) 문제를 풀어 이루어진다.</p>

<p><br /></p>
<h2 id="opf-예시-및-문헌-소개">OPF 예시 및 문헌 소개</h2>

<p>이를테면 아래 그림의 교류전력망에 대해 OPF 문제를 풀어, 각 발전기의 유효전력과 무효전력 공급량 및 변압기의 전압비와 위상차를 결정해야 한다. 단, 2개 bus에서의 전력부하를 충족하고, 각 bus의 전압 크기와 위상각을 적정 범위 내로 유지하면서, 3개 발전기 연료비의 합을 최소화해야 한다.</p>

<p><img src="/assets/images/opf/network.png" alt="optimal power flow" class="align-center" />
<em>5개의 bus, 3개의 발전기, 2개의 부하로 이루어진 전력망 대상 OPF 문제. 출처: An introduction to optimal power flow: Theory, formulation, and examples</em></p>

<p>OPF 문제를 제대로 다루려면 전력시스템공학을 제대로 공부해야 한다. 이를테면 필자는 서울대학교 대학원 재학 시절 <a href="http://sepri.snu.ac.kr/ko/node/9">문승일 교수님</a>의 전력시스템공학 수업에서 <a href="https://www.amazon.com/Power-Systems-Analysis-Arthur-Bergen/dp/0136919901">Power System Analysis</a> 교재를 공부했었다. 그러나 전력시스템공학의 내용이 방대하고 복잡하여, 본인 연구에 직접 적용하지 않는 한 대부분의 내용을 잊어버리기 쉽다.</p>

<p>다행히, OPF 문제의 기초를 ‘수학적 최적화 문제 구성 및 풀이’ 관점에서 간결하게 설명한 문헌이 있다. <a href="http://kgut.ac.ir/useruploads/1544077350809fgp.pdf">An introduction to optimal power flow: Theory, formulation, and examples</a> 이다.</p>

<p>이번 포스팅에서는, 해당 문헌의 OPF 문제 설명 및 numerical example 풀이 코드를 한국어로 재설명한다.</p>

<p><br /></p>
<h2 id="opf-풀이에-쓰이는-수식들">OPF 풀이에 쓰이는 수식들</h2>

<p>Bus $1,2,\dots,N$의 복소전압 (즉 범위제약 대상인 전압 크기와 위상각 정보를 담은 복소수) 들을 원소로 하는 복소벡터를 $\tilde{V} = (\tilde{V}_1,\dots,\tilde{V}_N)$ 라 하자.</p>

<p>그리고 bus $i$의 복소전력을 $S_i = P_i + j Q_i$ 라 하고 ($j=\sqrt{-1}$), 유효전력 $P_i = P_i^G - P_i^L$ 를 bus $i$에서 발전되는 유효전력 $P_i^G$와 소비되는 유효전력 $P_i^L$ 간 차이라 하고, 비슷하게 무효전력 $Q_i = Q_i^G - Q_i^L$ 이라 하며, bus $1,2,\dots,N$의 복소전력들을 원소로 하는 복소벡터를 $S = (S_1, \dots, S_N)$ 라 하자.</p>

<p>그러면 복소전류 벡터를 $\tilde{I}$라 할 때 $S = \tilde{V} \circ \tilde{I}^{*}$이다 ($\circ$는 두 벡터 간에 각각 대응하는 원소끼리의 곱, 윗첨자 *는 켤레복소수).</p>

<p>이렇게 되는 이유는, 교류 전압을 $v(t) = V_{max} \text{cos}(wt+\theta_V)$라 하고 교류 전류를 $i(t) = I_{max} cos(wt+\theta_I)$라 할 때 전력이 아래와 같이 계산되고,<br /> 
$p(t) = v(t)i(t) = 0.5 V_{max}I_{max}[\text{cos}(\theta_V - \theta_I) + \text{cos}(2wt + \theta_V + \theta_I)]$<br /><br />
‘시간에 대한 평균’ 전력은 $0.5 V_{max}I_{max}[\text{cos}(\theta_V - \theta_I)]$이며, 복소전압 $V$와 복소전류 $I$를 각각 $\vert V \vert = V_{max}/\sqrt{2}$, $\vert I \vert = I_{max}/\sqrt{2}$ 가 되게 정의하면 평균적 전력은 아래처럼 계산되기 때문이다.<br /> 
$P = \text{Re} \vert V \vert e^{j \theta_V} \vert I \vert e^{-j \theta_I} = \text{Re} V I^{*}$</p>

<p>한편 $\tilde{I}$와 $\tilde{V}$ 간에는 $\tilde{I} = \tilde{Y} \tilde{V}$의 관계가 성립하며, 복소행렬 $\tilde{Y}$를 admittance matrix라 한다. 이는 전류가 잘 흐르는 정도를 나타내는 system parameter로 볼 수 있다.</p>

<p>즉, admittance matrix를 $\tilde{Y}$를 구해야 OPF 문제를 풀 수 있다.</p>

<p>특정 두 bus $i$와 $k$를 잇는 전선의 resistance (전력을 소모하는 성분) 을 $R_{ik}$, reactance (코일 등에 의해 교류전력의 위상을 바꾸는 성분) 를 $X_{ik}$라 하면, 해당 전선의 교류전압과 교류전류의 비인 impedence는 $R_{ik} + j X_{ik}$ 이다.</p>

<p>Admittance matrix 계산에서는 impedence의 역수인 series admittance $\tilde{y}_{ik} = (R_{ik} + j X_{ik})^{-1}$를 활용한다.</p>

<p>한편 전선 및 bus 자체에서 전류 누설이 발생할 수 있는데, 이에 관련된 admittance parameter를 shunt admittance라 한다. 두 bus $i$와 $k$를 잇는 전선의 shunt admittance는 $\tilde{y}_{ik}^{Sh}$로, bus $i$ 자체에서의 shunt admittance는 $\tilde{y}_i^{S}$로 표기한다.</p>

<p>서로 다른 두 bus $i$와 $k$를 잇는 전선이 존재할 경우 순서쌍 $(i,k)$가 집합 $\textbf{L}$에 속한다고 하고, $(i,k) \in \textbf{L}$ 이면 $(k,i) \notin \textbf{L}$ 이라고 하자.</p>

<p>그러면, admittance matrix $\tilde{Y}$의 각 성분 $\tilde{Y}_{ik}$는 아래와 같이 계산된다.</p>

<p>\begin{align} 
\tilde{Y}_{ii} = \tilde{y}_i^{S} +\sum_{k:(i,k) \in \textbf{L}} \frac{1}{\vert a_{ik} \vert^2} (\tilde{y}_{ik} + \frac{1}{2} \tilde{y}_{ik}^{Sh})+ \sum_{k:(k,i) \in \textbf{L}} (\tilde{y}_{ki} + \frac{1}{2} \tilde{y}_{ki}^{Sh})
\notag
\end{align}
\begin{align} 
\tilde{Y}_{ik} = - \sum_{k:(i,k) \in \textbf{L}} \frac{1}{ a_{ik}^{*}} \tilde{y}_{ik} - \sum_{k:(k,i) \in \textbf{L}} \frac{1}{ a_{ki}} \tilde{y}_{ki} \quad (i \ne k)
\notag
\end{align}</p>

<p>여기서 $a_{ik}=T_{ik} e^{j \phi_{ik}}$는 변압을 의미한다. 변압기가 따로 없으면 1이고, 변압기가 있으면 $T_{ik}$는 전압비, $\phi_{ik}$는 변압기 전후 위상차이다.</p>

<p>그리고 $\tilde{Y}_{ik} = G_{ik} + j B_{ik}$라 하고 ($G_{ik}$를 conductance, $B_{ik}$를 susceptance라 함), 복소전압 $\tilde{V}_i = V_i e^{j \delta_i}$로 나타낼 때, bus $i$에서의 복소전력 $S_i = P_i + j Q_i$를 구하는 식은 아래와 같다.</p>

<p>\begin{align} 
P_i = V_i \sum_{k=1}^N V_k [G_{ik} \text{cos}(\delta_i - \delta_k) + B_{ik} \text{sin} (\delta_i - \delta_k)]
\notag
\end{align}
\begin{align} 
Q_i = V_i \sum_{k=1}^N V_k [G_{ik} \text{sin}(\delta_i - \delta_k) - B_{ik} \text{cos} (\delta_i - \delta_k)]
\notag
\end{align}</p>

<p>이를 power flow equation이라 한다.</p>

<p>최적화 문제 코딩을 위해 power flow equation을 우변이 0인 형태로 다시 쓰고 $P_i = P_i^G - P_i^L$, $Q_i = Q_i^G - Q_i^L$ 를 대입하면 아래와 같다.</p>

<p>\begin{align} 
P_i^L - P_i^G + V_i \sum_{k=1}^N V_k [G_{ik} \text{cos}(\delta_i - \delta_k) + B_{ik} \text{sin} (\delta_i - \delta_k)] = 0 
\notag
\end{align}
\begin{align} 
Q_i^L - Q_i^G + V_i \sum_{k=1}^N V_k [G_{ik} \text{sin}(\delta_i - \delta_k) - B_{ik} \text{cos} (\delta_i - \delta_k)] = 0
\notag
\end{align}</p>

<p>이제 OPF 문제를 구성한다. OPF로 결정해야 할 변수들은 아래와 같다.</p>

<p>1) 각 bus의 전압의 크기와 위상각<br />
2) Bus 1,3,4의 발전기의 유효전력과 무효전력<br />
3) Bus 3과 4 간 변압기의 위상차 (전압비는 1:1로 고정임)<br />
4) Bus 3과 5 간 변압기의 전압비 (위상차는 0으로 고정임)</p>

<p>등호 제약조건은 위 power flow equation이고, 부등호 제약조건은 각 bus 별 전압과 위상각의 적정 범위, 각 발전기 별 유효전력과 무효전력 출력의 상하한, 변압기의 전압비와 위상차의 상하한이다. 목적함수는 각 발전기 별 연료비의 합으로, 각 발전기 별 유효전력 출력의 이차함수로 주어진다.</p>

<p>주어지는 데이터는 각 전선 별 resistance/ reactance/ shunt admittance, 각 bus 별 shunt admittance, 각 부하의 요구 유효전력과 무효전력 값, bus 별 전압의 상하한 값, 발전기의 유효전력출력과 무효전력출력의 상하한 값이다.</p>

<p>이 문헌에서 소개하는 OPF 문제는 ‘한 시점에 대한’ 문제임에 주의한다. 해당 OPF 문제는 여러 시점들에 걸친 스케줄링 문제가 아니다.</p>

<p><br /></p>
<h2 id="예제-풀이용-python-코드">예제 풀이용 python 코드</h2>

<p>필요한 라이브러리는 Numpy, 그리고 비선형 최적화 문제의 제약조건 구현과 풀이에 필요한 Scipy.optimize의 NonlinearConstraint와 minimize 모듈이다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">scipy.optimize</span> <span class="kn">import</span> <span class="n">NonlinearConstraint</span><span class="p">,</span> <span class="n">minimize</span>
</code></pre></div></div>

<p>최적화 문제를 코드로 풀 때는 값을 결정할 변수들이 단일 벡터 $x$의 원소인데, $x$의 각 원소의 인덱스를 아래처럼 물리량의 이름을 따서 부여하면 코드를 읽기 쉽고 실수도 줄어든다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">v_bus</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># 인덱스 0~4는 각 bus의 전압크기
</span><span class="n">del_bus</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 인덱스 5~9는 각 bus의 전압위상각
</span><span class="n">p_bus</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 인덱스 10~14는 각 bus 내 발전기의 유효전력 (발전기가 없으면 0)
</span><span class="n">q_bus</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 인덱스 15~19는 각 bus 내 발전기의 무효전력 (발전기가 없으면 0)
</span><span class="n">phi_transf</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># 인덱스 20은 bus 3과 4 간 변압기의 위상차
</span><span class="n">mag_transf</span> <span class="o">=</span> <span class="mi">21</span> <span class="c1"># 인덱스 21은 bus 3과 5 간 변압기의 전압비
# 이를테면 # x[v_bus[0]] 은 1번 bus의 전압크기를, x[del_bus[1]] 은 2번 bus의 전압위상각을 의미
</span></code></pre></div></div>

<p>주어진 시스템 데이터인 각 전선 별 series admittance와 shunt admittance, 각 bus 별 shunt admittance, 각 부하의 유효전력 및 무효전력 요구치를 기재한다. 이 때 dtype=complex 로 두어 복소수로 쓴다.<br />
또한 모든 물리량은 per unit 단위법으로 쓰였음에 주의한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">n_bus</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">y_series</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">n_bus</span><span class="p">,</span><span class="n">n_bus</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span> <span class="c1"># 각 전선의 series admittance
</span><span class="n">y_sh_branch</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">n_bus</span><span class="p">,</span><span class="n">n_bus</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span> <span class="c1"># 각 전선의 shunt admittance
</span><span class="n">y_sh_bus</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">n_bus</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span> <span class="c1"># 각 bus의 shunt admittance
</span>
<span class="n">y_series</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">0</span><span class="o">+</span><span class="mf">0.3j</span><span class="p">)</span> <span class="c1"># bus 1과 2를 잇는 전선의 series admittance
</span><span class="n">y_series</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mf">0.023</span><span class="o">+</span><span class="mf">0.145j</span><span class="p">)</span> <span class="c1"># (i,k)가 L의 원소일 때 (k,i)는 L의 원소가 아닌 것과 같은 맥락으로 y_series[2,0] 은 설정하지 않음에 주의
</span><span class="n">y_series</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mf">0.006</span><span class="o">+</span><span class="mf">0.032j</span><span class="p">)</span>
<span class="n">y_series</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mf">0.02</span><span class="o">+</span><span class="mf">0.26j</span><span class="p">)</span>
<span class="n">y_series</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">0</span><span class="o">+</span><span class="mf">0.32j</span><span class="p">)</span>
<span class="n">y_series</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">0</span><span class="o">+</span><span class="mf">0.5j</span><span class="p">)</span>
<span class="n">y_sh_branch</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">+</span><span class="mf">0.04j</span><span class="p">)</span> <span class="c1"># bus 1과 3을 잇는 전선의 shunt admittance
</span><span class="n">y_sh_branch</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">+</span><span class="mf">0.01j</span><span class="p">)</span>
<span class="n">y_sh_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="o">+</span><span class="mf">0.3j</span> <span class="c1"># bus 2의 shunt admittance
</span><span class="n">y_sh_bus</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.05</span><span class="o">+</span><span class="mf">0j</span>
    
<span class="n">load_bus</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mi">0</span><span class="o">+</span><span class="mf">0j</span><span class="p">,</span> <span class="mi">0</span><span class="o">+</span><span class="mf">0j</span><span class="p">,</span> <span class="mi">0</span><span class="o">+</span><span class="mf">0j</span><span class="p">,</span> <span class="mf">0.9</span><span class="o">+</span><span class="mf">0.4j</span><span class="p">,</span> <span class="mf">0.239</span><span class="o">+</span><span class="mf">0.129j</span><span class="p">])</span> <span class="c1"># bus 4와 5의 전력 부하
</span></code></pre></div></div>

<p>비선형 제약조건인 power flow equation을 $x$의 사용자 정의 함수로 정의한다. 먼저 admittance matrix $\tilde{Y}$를 계산하고, 그 뒤에 $P_i$와 $Q_i$에 대한 등식을 기재한다. 이 문제에서는 변압기가 있으므로 $\tilde{Y}$ 계산 내 $a_{ik}$가 최적화로 값을 구할 변수의 함수이기 때문에, $\tilde{Y}$ 계산이 사용자 정의 함수 내에서 이루어져야 함에 주의한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">nonlconfun</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="c1"># 비선형 제약조건의 좌변을 변수들의 함수로 계산
</span>
    <span class="n">a_tx</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">ones</span><span class="p">((</span><span class="n">n_bus</span><span class="p">,</span><span class="n">n_bus</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span> <span class="c1"># 변압비와 위상차 phasor        
</span>    <span class="n">a_tx</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="mf">1j</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">phi_transf</span><span class="p">])</span> <span class="c1"># bus 3과 4 간 변압기의 위상차는 최적화로 도출 필요
</span>    <span class="n">a_tx</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">mag_transf</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="mf">1j</span><span class="o">*</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># bus 3과 5 간 변압기의 전압비는 최적화로 도출 필요
</span>    
    <span class="n">y_full</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">n_bus</span><span class="p">,</span><span class="n">n_bus</span><span class="p">),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span> <span class="c1"># admittance matrix
</span>    
    <span class="k">for</span> <span class="n">fr</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n_bus</span><span class="p">):</span>
        <span class="n">y_full</span><span class="p">[</span><span class="n">fr</span><span class="p">,</span><span class="n">fr</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_sh_bus</span><span class="p">[</span><span class="n">fr</span><span class="p">]</span> <span class="c1"># Y_ii
</span>        <span class="k">for</span> <span class="n">to</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n_bus</span><span class="p">):</span>
            <span class="n">y_full</span><span class="p">[</span><span class="n">fr</span><span class="p">,</span><span class="n">fr</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_full</span><span class="p">[</span><span class="n">fr</span><span class="p">,</span><span class="n">fr</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_series</span><span class="p">[</span><span class="n">fr</span><span class="p">,</span><span class="n">to</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">y_sh_branch</span><span class="p">[</span><span class="n">fr</span><span class="p">,</span><span class="n">to</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">a_tx</span><span class="p">[</span><span class="n">fr</span><span class="p">,</span><span class="n">to</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_series</span><span class="p">[</span><span class="n">to</span><span class="p">,</span><span class="n">fr</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">y_sh_branch</span><span class="p">[</span><span class="n">to</span><span class="p">,</span><span class="n">fr</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">to</span> <span class="o">!=</span> <span class="n">fr</span><span class="p">:</span> <span class="c1"># Y_ik
</span>                <span class="n">y_full</span><span class="p">[</span><span class="n">fr</span><span class="p">,</span><span class="n">to</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_full</span><span class="p">[</span><span class="n">fr</span><span class="p">,</span><span class="n">to</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_series</span><span class="p">[</span><span class="n">fr</span><span class="p">,</span><span class="n">to</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="nf">conjugate</span><span class="p">(</span><span class="n">a_tx</span><span class="p">[</span><span class="n">fr</span><span class="p">,</span><span class="n">to</span><span class="p">])</span> <span class="o">-</span> <span class="n">y_series</span><span class="p">[</span><span class="n">to</span><span class="p">,</span><span class="n">fr</span><span class="p">]</span><span class="o">/</span><span class="n">a_tx</span><span class="p">[</span><span class="n">to</span><span class="p">,</span><span class="n">fr</span><span class="p">]</span> 
    
    <span class="n">ceq</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">n_bus</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span> <span class="c1"># 제약조건의 좌변 값을 담을 벡터
</span>    
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n_bus</span><span class="p">):</span> <span class="c1"># Power flow equation
</span>        <span class="n">ceq</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">real</span><span class="p">(</span><span class="n">load_bus</span><span class="p">[</span><span class="n">m</span><span class="p">])</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">p_bus</span><span class="p">[</span><span class="n">m</span><span class="p">]]</span> <span class="c1"># 인덱스 0, 1, ..., m-1은 유효전력
</span>        <span class="n">ceq</span><span class="p">[</span><span class="n">n_bus</span><span class="o">+</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">imag</span><span class="p">(</span><span class="n">load_bus</span><span class="p">[</span><span class="n">m</span><span class="p">])</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">q_bus</span><span class="p">[</span><span class="n">m</span><span class="p">]]</span> <span class="c1"># 인덱스 m, m+1, ..., 2m-1은 무효전력
</span>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n_bus</span><span class="p">):</span>
            <span class="n">ceq</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">ceq</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">v_bus</span><span class="p">[</span><span class="n">m</span><span class="p">]]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">v_bus</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">real</span><span class="p">(</span><span class="n">y_full</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="n">k</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">del_bus</span><span class="p">[</span><span class="n">m</span><span class="p">]]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">del_bus</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span> <span class="o">+</span> <span class="n">np</span><span class="p">.</span><span class="nf">imag</span><span class="p">(</span><span class="n">y_full</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="n">k</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">del_bus</span><span class="p">[</span><span class="n">m</span><span class="p">]]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">del_bus</span><span class="p">[</span><span class="n">k</span><span class="p">]]))</span> <span class="c1"># real power at bus m
</span>            <span class="n">ceq</span><span class="p">[</span><span class="n">n_bus</span><span class="o">+</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">ceq</span><span class="p">[</span><span class="n">n_bus</span><span class="o">+</span><span class="n">m</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">v_bus</span><span class="p">[</span><span class="n">m</span><span class="p">]]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">v_bus</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">real</span><span class="p">(</span><span class="n">y_full</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="n">k</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">del_bus</span><span class="p">[</span><span class="n">m</span><span class="p">]]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">del_bus</span><span class="p">[</span><span class="n">k</span><span class="p">]])</span> <span class="o">-</span> <span class="n">np</span><span class="p">.</span><span class="nf">imag</span><span class="p">(</span><span class="n">y_full</span><span class="p">[</span><span class="n">m</span><span class="p">,</span><span class="n">k</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">del_bus</span><span class="p">[</span><span class="n">m</span><span class="p">]]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">del_bus</span><span class="p">[</span><span class="n">k</span><span class="p">]]))</span> <span class="c1"># reactive power at bus m
</span>    
    <span class="k">return</span> <span class="n">ceq</span> <span class="c1"># 제약조건의 좌변 값을 반환
</span></code></pre></div></div>

<p>목적함수를 $x$의 사용자 정의 함수로 정의한다. 목적함수인 발전기의 연료비의 합은 각 발전기 별 유효전력의 이차함수이다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">objfun</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="mf">0.35</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">p_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="mf">0.2</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">p_bus</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> <span class="o">+</span> <span class="mf">0.4</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">p_bus</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">0.3</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">p_bus</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">p_bus</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">cost</span>
</code></pre></div></div>

<p>각 변수의 상하한을 설정하되, 1번 bus를 slack bus로 생각하고 설정한다. 초기값은 변수별 상하한 간 중간값으로 설정한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="c1"># Bus 1은 Slack Bus이므로 전압크기 1로 고정
</span>        <span class="p">(</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">1.05</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">1.05</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">1.05</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">1.05</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="c1"># Bus 1은 Slack Bus이므로 위상각 0으로 고정
</span>        <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">,</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">),</span> <span class="c1"># 위상각의 단위가 radian임에 주의
</span>        <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">,</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">),</span>
        <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">,</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">),</span>
        <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">,</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">),</span>
        <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="c1"># Bus 1은 unrestricted
</span>        <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="c1"># Bus 2에는 발전기 없어 0으로 고정
</span>        <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.4</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.4</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="c1"># Bus 5에는 발전기 없어 0으로 고정
</span>        <span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="c1"># Bus 1은 unrestricted
</span>        <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="c1"># Bus 2에는 발전기 없어 0으로 고정
</span>        <span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span>
        <span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="c1"># Bus 5에는 발전기 없어 0으로 고정
</span>        <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">6</span><span class="p">,</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">1.05</span><span class="p">)]</span>

<span class="n">initialpoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">bounds</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">bounds</span><span class="p">)[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
</code></pre></div></div>

<p>Power flow equation은 복잡한 비선형 방정식이다. 그러므로 일반적인 비선형 문제를 푸는 solver를 사용해야 한다. 여기서는 Scipy.optimize의 NonlinearConstraint와 minimize 모듈을 이용한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nonlcon</span> <span class="o">=</span> <span class="nc">NonlinearConstraint</span><span class="p">(</span><span class="n">nonlconfun</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">n_bus</span><span class="o">*</span><span class="mi">2</span><span class="p">,)),</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">n_bus</span><span class="o">*</span><span class="mi">2</span><span class="p">,)))</span> <span class="c1"># 모든 변수들에 대해 우변의 하한과 상한이 모두 0, 즉 우변이 0인 등호조건
</span>
<span class="n">sol</span> <span class="o">=</span> <span class="nf">minimize</span><span class="p">(</span><span class="n">objfun</span><span class="p">,</span><span class="n">initialpoint</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span><span class="n">constraints</span><span class="o">=</span><span class="n">nonlcon</span><span class="p">)</span> <span class="c1"># solver로 OPF 문제 풀기
</span>
<span class="n">solution</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">multiply</span><span class="p">(</span><span class="n">sol</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="c1"># 전압 위상각의 단위를 radian에서 degree로 변환
</span>                       <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
<span class="nf">print</span><span class="p">(</span><span class="n">solution</span><span class="p">[</span><span class="n">v_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">solution</span><span class="p">[</span><span class="n">v_bus</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">solution</span><span class="p">[</span><span class="n">v_bus</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span><span class="n">solution</span><span class="p">[</span><span class="n">v_bus</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
      <span class="n">solution</span><span class="p">[</span><span class="n">del_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">solution</span><span class="p">[</span><span class="n">del_bus</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">solution</span><span class="p">[</span><span class="n">del_bus</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span><span class="n">solution</span><span class="p">[</span><span class="n">del_bus</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
      <span class="n">solution</span><span class="p">[</span><span class="n">p_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">solution</span><span class="p">[</span><span class="n">p_bus</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">solution</span><span class="p">[</span><span class="n">p_bus</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
      <span class="n">solution</span><span class="p">[</span><span class="n">q_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">solution</span><span class="p">[</span><span class="n">q_bus</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="n">solution</span><span class="p">[</span><span class="n">q_bus</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
      <span class="n">solution</span><span class="p">[</span><span class="n">phi_transf</span><span class="p">],</span><span class="n">solution</span><span class="p">[</span><span class="n">mag_transf</span><span class="p">])</span>          
</code></pre></div></div>

<p>코드를 실행하면, 논문에서 제시한 답과 같은 결과를 얻는다.</p>

<p><img src="/assets/images/opf/solution.png" alt="solution of OPF" class="align-center" />
<em>OPF 문제의 해답 (좌측은 논문 내용, 우측은 필자가 작성한 코드의 마지막 print문 결과).</em></p>

<p>전체 코드는 <a href="https://github.com/song4energyndata/Codes/blob/main/nonlinearoptimization/opfcode.py">필자의 GitHub Repo</a>에 업로드하였다.</p>

<p>해당 numerical example의 한계점은, 각 전선의 전류량 상한을 고려하지 않았다는 점이다. 실제로는 전선에 전류가 지나치게 많이 흐르면 전선이 열손상을 입기 때문에, 전선별로 thermal limit이 있다. 필요 시 전선 별 thermal limit을 추가적인 비선형 부등호 제약조건으로 반영해야 할 것으로 보인다.</p>

        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> 태그: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#optial-power-flow" class="page__taxonomy-item p-category" rel="tag">Optial Power Flow</a><span class="sep">, </span>
    
      <a href="/tags/#%EA%B2%BD%EC%A0%9C%EC%84%B1%EB%B6%84%EC%84%9D" class="page__taxonomy-item p-category" rel="tag">경제성분석</a>
    
    </span>
  </p>



<!-- 
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> 카테고리: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#optimalsystem" class="page__taxonomy-item p-category" rel="tag">optimalsystem</a>
    
    </span>
  </p>

 -->
        <!-- 

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> 업데이트:</strong> <time class="dt-published" datetime="2023-11-11T00:00:00+09:00">2023-11-11</time></p>
 -->
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">공유하기</h4>
  

  <!-- <a href="https://twitter.com/intent/tweet?text=Optimal+power+flow+%EC%98%88%EC%A0%9C+%EC%86%8C%EA%B0%9C+%EB%AC%B8%ED%97%8C+%EB%B0%8F+%ED%92%80%EC%9D%B4+%EC%BD%94%EB%93%9C%20http%3A%2F%2Flocalhost%3A4000%2Fopf.html" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> -->

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fopf.html" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fopf.html" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="공유하기 LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      <p></p>
        <!-- <h4 class="page__meta-title"><span>optimalsystem</span> <span>카테고리 내 다른 글 보러가기</span></h4> -->
        


  
  	
  	
  	
  	
  	

<nav class="pagination_prev_next"> <!-- 식빵맘 코드에서 조금 수정함 -->

  
    
      <a href="#" class="pagination_prev_next--pager disabled-last-child ">가장 최근 글입니다</a>
    
    
      <a href="/linprogten.html" class="pagination_prev_next--pager"><span class="prev_next">이전 글  &nbsp</span>선형계획법 기반 분산에너지시스템 최적화 - 10) 출력 조정 관련 제약들</a>
        
  

</nav>
      <p></p>
    </div>

    
  </article>

  
  <!-- 
    <div class="page__related">
      <h2 class="page__related-title">참고</h2>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <a href="/hourlysolar.html" rel="permalink"><img src="/assets/images/solarradiation/diffuse.png" alt=""></a>
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/hourlysolar.html" rel="permalink">시간별 태양광 발전량 계산 모델 수식 설명
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2023-11-25T00:00:00+09:00">2023-11-25</time>
      </span>
    

    

    
  </p>


    <p class="archive__item-excerpt" itemprop="description">태양광 패널을 포함하는 마이크로그리드의 경제성 분석을 위해서는 시간별 태양광 발전량을 계산해야 한다. 필자가 국내 케이스의 계산에 사용하는 데이터로는 기상청에서 제공하는 시간별 일사량이 있다. 즉, 시간별 일사량 데이터를 태양광 발전량으로 변환해야 한다.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/koreanmarketrules.html" rel="permalink">국내 전력시장 주요 운영규칙 핵심사항 정리
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2023-10-22T00:00:00+09:00">2023-10-22</time>
      </span>
    

    

    
  </p>


    <p class="archive__item-excerpt" itemprop="description">최근 에너지 플랫폼 업계 현직자들과 대화를 하며, 국내 전력시장 운영규칙을 상세히 알 필요성을 느꼈다. 본격적으로 에너지 플랫폼 업계에 종사한다면 전력시장 입찰을 전제로 한 에너지 설비들의 데이터 및 비즈니스 모델을 주로 분석하게 될 것이라 생각했기 때문이다. (그간 필자는 BTM...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <a href="/evestimate.html" rel="permalink"><img src="/assets/images/evestimates/teaser.png" alt=""></a>
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/evestimate.html" rel="permalink">논문 소개: 전기차 충전 이력 데이터 기반의, 계통 내 시간별 전기차 충전 부하 시뮬레이션
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2023-10-21T00:00:00+09:00">2023-10-21</time>
      </span>
    

    

    
  </p>


    <p class="archive__item-excerpt" itemprop="description">전기차 및 충전 인프라 규모가 증가할수록 전력계통에 걸리는 부하가 증가한다. 그러므로 향후 발전/ 송전/ 배전 (특히 배전단) 설비 및 스케줄링 계획 수립을 위해, 전기차 충전으로 인한 시간별 부하 증가를 정확히 예측할 필요가 있다.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <a href="/marketadvanced.html" rel="permalink"><img src="/assets/images/jalal/advanced.png" alt=""></a>
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/marketadvanced.html" rel="permalink">재생발전 비중이 높은 전력시장에 대한 심화 주제들
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2023-10-07T00:00:00+09:00">2023-10-07</time>
      </span>
    

    

    
  </p>


    <p class="archive__item-excerpt" itemprop="description">필자가 정리했던 Jalal Kazempour 교수의 전력시장 강의에서 reference로써 추천한 책으로, Integrating Renewables in Electricity Markets: Operational Problems 이 있다.
</p>
  </article>
</div>

        
      </div>
    </div> -->
  
  <!--  -->
</div>

  </div>

  

  <aside class="sidebar__top">
    <a href="#site-nav"> <i class="fas fa-angle-double-up fa-2x"></i></a>
    </aside>

  <div id="footer" class="page__footer">
    <footer>
      <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
      <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Contact:</strong></li>
    

    
      
        
          <li><a href="mailto:song4energy@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
        
      
        
          <li><a href="https://github.com/song4energyndata" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> 피드</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 송정훈. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

    </footer>
  </div>

  
  <script src="/assets/js/main.min.js"></script>










</body>

</html>